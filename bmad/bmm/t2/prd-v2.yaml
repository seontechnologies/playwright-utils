# <!-- Powered by BMAD™ Core -->
metadata:
  name: Product Requirements Document
  version: 2.0
  output: "{project-root}/{output-directory}/prd.md"

config:
  module: bmm
  inherit_variables: true
  variables:
    - output-directory
    - project-name
    - default-author

inputs:
  suggest:
    - name: project_brief
      path: "{project-root}/{output-directory}/brief.md"
      required: false
      message: "Do you have a Project Brief document? It provides essential foundation for the PRD."
    - name: technical_preferences
      path: "{project-root}/data/technical-preferences.yaml"
      required: false
      message: "Technical preferences file can help guide technical requirements."

variables:
  project_name:
    prompt: "What is the project name?"
    default: "Unnamed Project"

  author:
    prompt: "Who is the author?"
    default: "Product Manager"

  epic_count:
    type: dynamic
    source: epic_list_section

workflow:
  mode: interactive
  elicitation: true

sections:
  goals:
    instruction: |
      Ask if Project Brief document is available. If NO Brief exists, STRONGLY recommend
      creating one first using brief template. If Brief exists, review and use it to
      populate Goals (bullet list of desired outcomes).

      Focus on user and project desires. Be specific and measurable where possible.
    type: bullet-list
    min_items: 3
    max_items: 7
    elicit: true
    examples:
      - "Reduce manual data entry by 80% through automation"
      - "Enable real-time collaboration for distributed teams"
      - "Achieve 99.9% uptime for critical services"

  background_context:
    instruction: |
      1-2 short paragraphs summarizing the background context:
      - What we learned in the brief (without being redundant with goals)
      - What problem this solves and why
      - Current landscape or need
    type: paragraph
    max_length: 300_words

  change_log:
    instruction: |
      Track document versions and changes.
      Create a change log table with columns: Date | Version | Description | Author
      Initialize with first entry for document creation.
    type: table
    columns: [Date, Version, Description, Author]
    initial_row: ["{{today}}", "1.0", "Initial PRD creation", "{{author}}"]

  functional_requirements:
    instruction: |
      Draft functional requirements that are specific, testable, and achievable.
      Each requirement must directly support the stated goals.
      Format: "FR[number]: [requirement description]"
    type: numbered-list
    prefix: "FR"
    template: "FR{{number}}: {{description}}"
    elicit: true
    examples:
      - "FR1: Users must be able to create an account using email or social login"
      - "FR6: The Todo List uses AI to detect and warn against potentially duplicate todo items"

  non_functional_requirements:
    instruction: |
      Define non-functional requirements for performance, security, scalability, etc.
      Format: "NFR[number]: [requirement description]"
    type: numbered-list
    prefix: "NFR"
    template: "NFR{{number}}: {{description}}"
    examples:
      - "NFR1: AWS service usage must aim to stay within free-tier limits where feasible"
      - "NFR2: Page load time must be under 2 seconds on 3G connections"

  ui_goals:
    condition: has_ui_requirements
    instruction: |
      Capture high-level UI/UX vision to guide Design Architect and inform story creation.

      Steps:
      1. Pre-fill all subsections with educated guesses based on project context
      2. Present the complete rendered section to user
      3. Clearly indicate where assumptions were made
      4. Ask targeted questions for unclear/missing elements

      This is NOT detailed UI spec - focus on product vision and user goals.
    elicit: true
    subsections:
      - id: ux_vision
        title: Overall UX Vision
        instruction: |
          Describe overall user experience vision:
          - Key design principles
          - User journey priorities
          - Emotional design goals

      - id: interaction_paradigms
        title: Key Interaction Paradigms
        instruction: |
          Define primary interaction patterns:
          - Navigation approach
          - Data input methods
          - Feedback mechanisms
          - Mobile vs desktop interactions

      - id: core_screens
        title: Core Screens and Views
        instruction: |
          From product perspective, what are the most critical screens necessary
          to deliver PRD values and goals? Keep conceptual and high-level.
        examples:
          - "Login Screen"
          - "Main Dashboard"
          - "Item Detail Page"
          - "Settings Page"

      - id: accessibility
        title: Accessibility Requirements
        choices: [None, WCAG AA, WCAG AAA, Custom]
        instruction: "Specify accessibility standards"

      - id: branding
        title: Branding Guidelines
        instruction: |
          Any known branding elements or style guides that must be incorporated?
          - Visual identity requirements
          - Tone and voice guidelines
          - Existing brand assets

      - id: target_platforms
        title: Target Devices and Platforms
        choices: [Web Responsive, Mobile Only, Desktop Only, Cross-Platform]
        instruction: "Specify target platforms and any specific device requirements"

  technical_requirements:
    instruction: |
      Gather high-level technical decisions to guide the Architect.

      Steps:
      1. Check if technical-preferences.yaml exists - use it to pre-populate
      2. Review project brief for any technical constraints mentioned
      3. If technical info exists, present draft choices for confirmation
      4. For unknowns, offer guidance based on project goals and MVP scope
      5. Document ALL technical choices with rationale
      6. Add hard requirements as TR-[number]: [description]
    elicit: true
    type: mixed
    subsections:
      - id: tech_requirements_list
        type: numbered-list
        prefix: "TR"
        template: "TR{{number}}: {{requirement}}"
        examples:
          - "TR1: Python for API"
          - "TR2: AWS Serverless"
          - "TR3: DynamoDB"
          - "TR4: TypeScript with NextJS + React"

  user_journeys:
    instruction: |
      Map primary user flows that MVP must support.

      Steps:
      1. Review brief and previous sections for user information
      2. Identify primary user types
      3. Map end-to-end value realization journeys
      4. Include all touchpoints: discovery, onboarding, core usage, troubleshooting
      5. Connect journey steps to functional requirements (reference FR numbers)
      6. Highlight critical decision points and potential friction
    elicit: true
    subsections:
      - id: primary_journey
        title: Primary User Journey
        template: "Entry Point → Key Actions → Value Realization → Success Metrics"

      - id: secondary_journeys
        title: Secondary User Journeys
        optional: true

      - id: journey_insights
        title: Journey Insights and Dependencies
        instruction: |
          Analyze journeys for strategic insights:
          - Key decision points and drop-off moments
          - Minimum viable journey requirements
          - Epic sequencing implications
          - Success metrics for each stage

  out_of_scope:
    instruction: |
      Define what is explicitly NOT included in this PRD to maintain MVP focus.
      Format as bullet points with brief rationale.
    type: bullet-list
    template: "{{feature}}: {{rationale}}"
    examples:
      - "Advanced analytics dashboard: Not essential for core workflows, post-MVP"
      - "Social media integrations: Additional complexity without serving primary use cases"
      - "Multi-language support: Single language sufficient for target market validation"

  epic_list:
    instruction: |
      Present high-level list of all epics for user approval.

      CRITICAL: Epics MUST be logically sequential:
      - Each epic delivers significant, deployable functionality
      - Epic 1 must establish foundational infrastructure
      - Each subsequent epic builds upon previous functionality
      - Cross-cutting concerns flow through epics, not as final stories

      Err on side of fewer epics. Let user know rationale and offer splitting options.
    elicit: true
    type: numbered-list
    template: "Epic {{number}}: {{title}} - {{one_line_goal}}"
    examples:
      - "Epic 1: Foundation & Core Infrastructure: Establish project setup, auth, and basic user management"
      - "Epic 2: Core Business Entities: Create and manage primary domain objects with CRUD"
      - "Epic 3: User Workflows: Enable key user journeys and business processes"

  epic_details:
    instruction: |
      Process each epic with all its stories as complete review unit.
      Provide expanded goal (2-3 sentences) describing objectives and value.

      CRITICAL STORY REQUIREMENTS:
      - Stories must be logically sequential within epic
      - Each is a "vertical slice" of complete functionality
      - No dependencies on later stories/epics
      - Focus on "what" and "why" not "how"
      - Size for AI agent execution (2-4 hour scope)
      - Think "junior developer working focused session"
    elicit: true
    repeatable: true
    count: "{{epic_count}}"
    template: |
      ## Epic {{number}}: {{title}}

      ### Epic Goal
      {{epic_goal}}

      ### User Stories
      {{stories}}

      ### Epic Summary
      {{epic_summary}}
    story_template: |
      #### Story {{epic}}.{{story}}: {{title}}

      **User Story:**
      As a {{user_type}},
      I want {{action}},
      So that {{benefit}}.

      **Prerequisites:** {{prerequisites}}

      **Acceptance Criteria:**
      {{acceptance_criteria}}

  checklist_results:
    instruction: |
      Before running checklist, offer to output full updated PRD.
      Once user confirms, execute prd-checklist and populate results here.
    type: checklist_report

  next_steps:
    instruction: |
      Define immediate next steps and prompts for other agents.
      If there's a UX component, suggest UX-Agent next, else proceed to Architect.
      Recommend starting new context chat with chosen agent using this document as input.
    subsections:
      - id: immediate_actions
        type: bullet-list
      - id: ux_expert_prompt
        condition: has_ui_requirements
        type: text
      - id: architect_prompt
        type: text
